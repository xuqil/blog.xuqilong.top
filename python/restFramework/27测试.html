<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>测试中 | FeelingLive</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/assets/img/logo/logo.png">
    <script>
            var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?966c32065299cfcd0ae5ae2eae1aa280";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();            
          </script>
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.57bcb71c.css" as="style"><link rel="preload" href="/assets/js/app.b8069efc.js" as="script"><link rel="preload" href="/assets/js/2.463f0d24.js" as="script"><link rel="preload" href="/assets/js/40.99b7368a.js" as="script"><link rel="prefetch" href="/assets/js/10.0762cba9.js"><link rel="prefetch" href="/assets/js/11.4708d5da.js"><link rel="prefetch" href="/assets/js/12.c6cafa54.js"><link rel="prefetch" href="/assets/js/13.d8200bdf.js"><link rel="prefetch" href="/assets/js/14.8064c10f.js"><link rel="prefetch" href="/assets/js/15.9243c1a6.js"><link rel="prefetch" href="/assets/js/16.f6f1013c.js"><link rel="prefetch" href="/assets/js/17.fc230ff5.js"><link rel="prefetch" href="/assets/js/18.f5401d4b.js"><link rel="prefetch" href="/assets/js/19.97ad76e6.js"><link rel="prefetch" href="/assets/js/20.c04d5e36.js"><link rel="prefetch" href="/assets/js/21.3a377e15.js"><link rel="prefetch" href="/assets/js/22.4f0e9918.js"><link rel="prefetch" href="/assets/js/23.8f5b85c7.js"><link rel="prefetch" href="/assets/js/24.e0dea9d9.js"><link rel="prefetch" href="/assets/js/25.6e5a4514.js"><link rel="prefetch" href="/assets/js/26.f1eb71b3.js"><link rel="prefetch" href="/assets/js/27.648fe148.js"><link rel="prefetch" href="/assets/js/28.0f4106c7.js"><link rel="prefetch" href="/assets/js/29.13fab01e.js"><link rel="prefetch" href="/assets/js/3.42c89626.js"><link rel="prefetch" href="/assets/js/30.776c58af.js"><link rel="prefetch" href="/assets/js/31.9d1301f0.js"><link rel="prefetch" href="/assets/js/32.720f8e3c.js"><link rel="prefetch" href="/assets/js/33.3e536bad.js"><link rel="prefetch" href="/assets/js/34.eb929122.js"><link rel="prefetch" href="/assets/js/35.d6c75691.js"><link rel="prefetch" href="/assets/js/36.d1359dcd.js"><link rel="prefetch" href="/assets/js/37.af9dcad6.js"><link rel="prefetch" href="/assets/js/38.4dcdfb0e.js"><link rel="prefetch" href="/assets/js/39.a11a56c7.js"><link rel="prefetch" href="/assets/js/4.32e9b2cd.js"><link rel="prefetch" href="/assets/js/41.6b4e41f7.js"><link rel="prefetch" href="/assets/js/42.01f4bb4d.js"><link rel="prefetch" href="/assets/js/43.395f4458.js"><link rel="prefetch" href="/assets/js/44.6ffa66fa.js"><link rel="prefetch" href="/assets/js/45.e29df2ce.js"><link rel="prefetch" href="/assets/js/46.72ff2f55.js"><link rel="prefetch" href="/assets/js/47.8ffb0064.js"><link rel="prefetch" href="/assets/js/48.2ca0eabc.js"><link rel="prefetch" href="/assets/js/49.9b2c63ae.js"><link rel="prefetch" href="/assets/js/5.92edf24a.js"><link rel="prefetch" href="/assets/js/50.115e85f5.js"><link rel="prefetch" href="/assets/js/51.8f5cbf89.js"><link rel="prefetch" href="/assets/js/52.4a6fde6e.js"><link rel="prefetch" href="/assets/js/53.b63a6ed6.js"><link rel="prefetch" href="/assets/js/54.fbb07875.js"><link rel="prefetch" href="/assets/js/55.e995daf3.js"><link rel="prefetch" href="/assets/js/56.15951fbe.js"><link rel="prefetch" href="/assets/js/57.4c91e795.js"><link rel="prefetch" href="/assets/js/58.02114ca3.js"><link rel="prefetch" href="/assets/js/6.0b766ead.js"><link rel="prefetch" href="/assets/js/7.beb00bfa.js"><link rel="prefetch" href="/assets/js/8.e469995f.js"><link rel="prefetch" href="/assets/js/9.35927e25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.57bcb71c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo/logo.png" alt="FeelingLive" class="logo"> <span class="site-name">FeelingLive</span></a> <nav class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <ul class="nav-links can-hide"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><!----> <span class="title">
      Python
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Python" class="mobile-dropdown-title"><!----> <span class="title">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/coroutine/" class="nav-link"><!----> <span>协程</span></a></li><li class="dropdown-item"><!----> <a href="/python/advance/" class="nav-link"><!----> <span>进阶</span></a></li><li class="dropdown-item"><!----> <a href="/python/standard/" class="nav-link"><!----> <span>标准库</span></a></li><li class="dropdown-item"><!----> <a href="/python/restFramework/" class="nav-link router-link-active"><!----> <span>REST Framework</span></a></li><li class="dropdown-item"><!----> <a href="/python/utils/" class="nav-link"><!----> <span>各种工具</span></a></li><li class="dropdown-item"><!----> <a href="/python/skill/" class="nav-link"><!----> <span>使用技巧和例子</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/basis/" class="nav-link"><!----> <span>基础</span></a></li></ul></div></li><li class="nav-item"><a href="/linux/" class="nav-link"><!----> <span>Linux</span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title">
      中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><!----> <span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middle/elasticsearch/" class="nav-link"><!----> <span>Elasticsearch</span></a></li><li class="dropdown-item"><!----> <a href="/middle/nginx/" class="nav-link"><!----> <span>Nginx</span></a></li><li class="dropdown-item"><!----> <a href="/middle/kafka/" class="nav-link"><!----> <span>Kafka</span></a></li><li class="dropdown-item"><!----> <a href="/middle/f5/" class="nav-link"><!----> <span>F5</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link"><!----> <span>MySQL</span></a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link"><!----> <span>Redis</span></a></li></ul></div></li><li class="nav-item"><a href="https://github.com/xuqil" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Git Hub</span> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <!----></ul> <div class="theme-switcher"><a class="switch dark"><span><i aria-hidden="true" class="fa fa-moon"></i></span></a></div></nav></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <ul class="nav-links"><li class="nav-item"><a href="/" class="nav-link"><!----> <span>主页</span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><!----> <span class="title">
      Python
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Python" class="mobile-dropdown-title"><!----> <span class="title">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/coroutine/" class="nav-link"><!----> <span>协程</span></a></li><li class="dropdown-item"><!----> <a href="/python/advance/" class="nav-link"><!----> <span>进阶</span></a></li><li class="dropdown-item"><!----> <a href="/python/standard/" class="nav-link"><!----> <span>标准库</span></a></li><li class="dropdown-item"><!----> <a href="/python/restFramework/" class="nav-link router-link-active"><!----> <span>REST Framework</span></a></li><li class="dropdown-item"><!----> <a href="/python/utils/" class="nav-link"><!----> <span>各种工具</span></a></li><li class="dropdown-item"><!----> <a href="/python/skill/" class="nav-link"><!----> <span>使用技巧和例子</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title">
      Java
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><!----> <span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/basis/" class="nav-link"><!----> <span>基础</span></a></li></ul></div></li><li class="nav-item"><a href="/linux/" class="nav-link"><!----> <span>Linux</span></a></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title">
      中间件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><!----> <span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middle/elasticsearch/" class="nav-link"><!----> <span>Elasticsearch</span></a></li><li class="dropdown-item"><!----> <a href="/middle/nginx/" class="nav-link"><!----> <span>Nginx</span></a></li><li class="dropdown-item"><!----> <a href="/middle/kafka/" class="nav-link"><!----> <span>Kafka</span></a></li><li class="dropdown-item"><!----> <a href="/middle/f5/" class="nav-link"><!----> <span>F5</span></a></li></ul></div></li><li class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title">
      数据库
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><!----> <span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link"><!----> <span>MySQL</span></a></li><li class="dropdown-item"><!----> <a href="/database/redis/" class="nav-link"><!----> <span>Redis</span></a></li></ul></div></li><li class="nav-item"><a href="https://github.com/xuqil" target="_blank" rel="noopener noreferrer" class="nav-link external"><!----> <span>Git Hub</span> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <!----></ul>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><i></i> <span>RESTFramework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python/restFramework/" aria-current="page" class="sidebar-link">要求</a></li><li><a href="/python/restFramework/10序列化器字段.html" class="sidebar-link">序列化器字段</a></li><li><a href="/python/restFramework/11序列化器关系.html" class="sidebar-link">序列化器关系</a></li><li><a href="/python/restFramework/12验证器.html" class="sidebar-link">验证者</a></li><li><a href="/python/restFramework/13身份验证.html" class="sidebar-link">认证方式</a></li><li><a href="/python/restFramework/14权限.html" class="sidebar-link">权限</a></li><li><a href="/python/restFramework/15缓存.html" class="sidebar-link">快取</a></li><li><a href="/python/restFramework/16节流.html" class="sidebar-link">节流</a></li><li><a href="/python/restFramework/17筛选.html" class="sidebar-link">筛选</a></li><li><a href="/python/restFramework/18分页.html" class="sidebar-link">分页</a></li><li><a href="/python/restFramework/19版本控制.html" class="sidebar-link">版本控制</a></li><li><a href="/python/restFramework/1请求.html" class="sidebar-link">Requests</a></li><li><a href="/python/restFramework/20内容协商.html" class="sidebar-link">内容协商</a></li><li><a href="/python/restFramework/21元数据.html" class="sidebar-link">元数据</a></li><li><a href="/python/restFramework/22架构.html" class="sidebar-link">架构图</a></li><li><a href="/python/restFramework/23格式后缀.html" class="sidebar-link">格式后缀</a></li><li><a href="/python/restFramework/24返回URL.html" class="sidebar-link">返回网址</a></li><li><a href="/python/restFramework/25异常.html" class="sidebar-link">例外情况</a></li><li><a href="/python/restFramework/26状态码.html" class="sidebar-link">状态码</a></li><li><a href="/python/restFramework/27测试.html" class="active sidebar-link">测试中</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#创建测试请求" class="sidebar-link">创建测试请求</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#强制认证" class="sidebar-link">强制认证</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#强制csrf验证" class="sidebar-link">强制CSRF验证</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#发出请求" class="sidebar-link">发出请求</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#验证中" class="sidebar-link">验证中</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#csrf验证" class="sidebar-link">CSRF验证</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#requestsclient并使用数据库" class="sidebar-link">RequestsClient并使用数据库</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#标头和身份验证" class="sidebar-link">标头和身份验证</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#csrf" class="sidebar-link">CSRF</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#现场测试" class="sidebar-link">现场测试</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#标头和身份验证-2" class="sidebar-link">标头和身份验证</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#例" class="sidebar-link">例</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#例-2" class="sidebar-link">例</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#检查响应数据" class="sidebar-link">检查响应数据</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#渲染回应" class="sidebar-link">渲染回应</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#设置默认格式" class="sidebar-link">设置默认格式</a></li><li class="sidebar-sub-header"><a href="/python/restFramework/27测试.html#设置可用格式" class="sidebar-link">设置可用格式</a></li></ul></li><li><a href="/python/restFramework/28设置.html" class="sidebar-link">设定值</a></li><li><a href="/python/restFramework/2响应.html" class="sidebar-link">Responses</a></li><li><a href="/python/restFramework/3视图..html" class="sidebar-link">基于类的视图</a></li><li><a href="/python/restFramework/4通用视图.html" class="sidebar-link">通用视图</a></li><li><a href="/python/restFramework/5视图集.html" class="sidebar-link">ViewSets</a></li><li><a href="/python/restFramework/6路由.html" class="sidebar-link">Routers</a></li><li><a href="/python/restFramework/7解析器.html" class="sidebar-link">解析器(Parsers)</a></li><li><a href="/python/restFramework/8渲染器.html" class="sidebar-link">渲染器</a></li><li><a href="/python/restFramework/9序列化器.html" class="sidebar-link">Serializers</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-vpx-content content__default"><h1 id="测试中"><a href="#测试中" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#testing" target="_blank" rel="noopener noreferrer">测试中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <blockquote><p>没有测试的代码按设计被破坏。</p> <p>— <a href="https://jacobian.org/writing/django-apps-with-buildout/#s-create-a-test-wrapper" target="_blank" rel="noopener noreferrer">雅各布·卡普兰·莫斯<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>REST框架包括一些帮助程序类，这些类扩展了Django现有的测试框架，并改善了对发出API请求的支持。</p> <h1 id="apirequestfactory"><a href="#apirequestfactory" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#apirequestfactory" target="_blank" rel="noopener noreferrer">APIRequestFactory<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>扩展<a href="https://docs.djangoproject.com/en/stable/topics/testing/advanced/#django.test.client.RequestFactory" target="_blank" rel="noopener noreferrer">Django的现有<code>RequestFactory</code>类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="创建测试请求"><a href="#创建测试请求" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#creating-test-requests" target="_blank" rel="noopener noreferrer">创建测试请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>本<code>APIRequestFactory</code>类支持几乎相同的API来Django的标准<code>RequestFactory</code>类。这意味着，标准<code>.get()</code>，<code>.post()</code>，<code>.put()</code>，<code>.patch()</code>，<code>.delete()</code>，<code>.head()</code>和<code>.options()</code>方法都是可用的。</p> <div class="language- extra-class"><pre class="language-text"><code>from rest_framework.test import APIRequestFactory

# Using the standard RequestFactory API to create a form POST request
factory = APIRequestFactory()
request = factory.post('/notes/', {'title': 'new idea'})
</code></pre></div><h4 id="使用format参数"><a href="#使用format参数" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#using-the-format-argument" target="_blank" rel="noopener noreferrer">使用<code>format</code>参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>它创建一个请求体的方法，例如<code>post</code>，<code>put</code>和<code>patch</code>，包括<code>format</code>参数，该参数可以很容易地生成使用除多部分形式的数据以外的内容类型的请求。例如：</p> <div class="language- extra-class"><pre class="language-text"><code># Create a JSON POST request
factory = APIRequestFactory()
request = factory.post('/notes/', {'title': 'new idea'}, format='json')
</code></pre></div><p>默认情况下，可用格式为<code>'multipart'</code>和<code>'json'</code>。为了与Django现有兼容，<code>RequestFactory</code>默认格式为<code>'multipart'</code>。</p> <p>要支持更多的请求格式集或更改默认格式，<a href="https://www.django-rest-framework.org/api-guide/testing/#configuration" target="_blank" rel="noopener noreferrer">请参阅“配置”部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="明确编码请求主体"><a href="#明确编码请求主体" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#explicitly-encoding-the-request-body" target="_blank" rel="noopener noreferrer">明确编码请求主体<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>如果需要显式编码请求正文，可以通过设置<code>content_type</code>标志来进行编码。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>request = factory.post('/notes/', json.dumps({'title': 'new idea'}), content_type='application/json')
</code></pre></div><h4 id="使用表格数据进行put和patch"><a href="#使用表格数据进行put和patch" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#put-and-patch-with-form-data" target="_blank" rel="noopener noreferrer">使用表格数据进行PUT和PATCH<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>值得注意的是Django <code>RequestFactory</code>和REST框架之间的区别<code>APIRequestFactory</code>是，多部分表单数据将被编码为just以外的方法<code>.post()</code>。</p> <p>例如，使用<code>APIRequestFactory</code>，您可以发出表单PUT请求，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>factory = APIRequestFactory()
request = factory.put('/notes/547/', {'title': 'remember to email dave'})
</code></pre></div><p>使用Django的<code>RequestFactory</code>，您需要自己对数据进行显式编码：</p> <div class="language- extra-class"><pre class="language-text"><code>from django.test.client import encode_multipart, RequestFactory

factory = RequestFactory()
data = {'title': 'remember to email dave'}
content = encode_multipart('BoUnDaRyStRiNg', data)
content_type = 'multipart/form-data; boundary=BoUnDaRyStRiNg'
request = factory.put('/notes/547/', content, content_type=content_type)
</code></pre></div><h2 id="强制认证"><a href="#强制认证" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#forcing-authentication" target="_blank" rel="noopener noreferrer">强制认证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>使用请求工厂直接测试视图时，通常能够直接对请求进行身份验证，而不必构造正确的身份验证凭据，这通常很方便。</p> <p>要强制验证请求，请使用<code>force_authenticate()</code>方法。</p> <div class="language- extra-class"><pre class="language-text"><code>from rest_framework.test import force_authenticate

factory = APIRequestFactory()
user = User.objects.get(username='olivia')
view = AccountDetail.as_view()

# Make an authenticated request to the view...
request = factory.get('/accounts/django-superstars/')
force_authenticate(request, user=user)
response = view(request)
</code></pre></div><p>该方法的签名为<code>force_authenticate(request, user=None, token=None)</code>。进行呼叫时，可以设置用户和令牌中的一个或两个。</p> <p>例如，当使用令牌强制进行身份验证时，您可能会执行以下操作：</p> <div class="language- extra-class"><pre class="language-text"><code>user = User.objects.get(username='olivia')
request = factory.get('/accounts/django-superstars/')
force_authenticate(request, user=user, token=user.auth_token)
</code></pre></div><hr> <p><strong>注意</strong>：<code>force_authenticate</code>直接设置<code>request.user</code>为内存中的<code>user</code>实例。如果要在<code>user</code>更新保存<code>user</code>状态的多个测试中重复使用同一实例，则可能需要<a href="https://docs.djangoproject.com/en/1.11/ref/models/instances/#django.db.models.Model.refresh_from_db" target="_blank" rel="noopener noreferrer"><code>refresh_from_db()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在测试之间调用。</p> <hr> <p><strong>注意</strong>：使用时<code>APIRequestFactory</code>，返回的对象是Django的standard <code>HttpRequest</code>，而不是REST框架的<code>Request</code>对象，该对象仅在调用视图后才生成。</p> <p>这意味着直接在请求对象上设置属性可能并不总是具有预期的效果。例如，<code>.token</code>直接设置将无效，而<code>.user</code>直接设置仅在使用会话身份验证时才有效。</p> <div class="language- extra-class"><pre class="language-text"><code># Request will only authenticate if `SessionAuthentication` is in use.
request = factory.get('/accounts/django-superstars/')
request.user = user
response = view(request)
</code></pre></div><hr> <h2 id="强制csrf验证"><a href="#强制csrf验证" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#forcing-csrf-validation" target="_blank" rel="noopener noreferrer">强制CSRF验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>默认情况下，使用创建的请求<code>APIRequestFactory</code>在传递到REST框架视图时将不应用CSRF验证。如果需要显式打开CSRF验证，则可以通过<code>enforce_csrf_checks</code>在实例化工厂时设置标志来进行。</p> <div class="language- extra-class"><pre class="language-text"><code>factory = APIRequestFactory(enforce_csrf_checks=True)
</code></pre></div><hr> <p><strong>注意</strong>：值得注意的是，Django的标准<code>RequestFactory</code>不需要包含此选项，因为使用常规Django时，CSRF验证在中间件中进行，而中间件在直接测试视图时不会运行。使用REST框架时，CSRF验证在视图内部进行，因此请求工厂需要禁用视图级CSRF检查。</p> <hr> <h1 id="api客户端"><a href="#api客户端" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#apiclient" target="_blank" rel="noopener noreferrer">API客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>扩展<a href="https://docs.djangoproject.com/en/stable/topics/testing/tools/#the-test-client" target="_blank" rel="noopener noreferrer">Django的现有<code>Client</code>类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="发出请求"><a href="#发出请求" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#making-requests" target="_blank" rel="noopener noreferrer">发出请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>本<code>APIClient</code>类支持相同的请求接口Django的标准<code>Client</code>类。这意味着，标准<code>.get()</code>，<code>.post()</code>，<code>.put()</code>，<code>.patch()</code>，<code>.delete()</code>，<code>.head()</code>和<code>.options()</code>方法都是可用的。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>from rest_framework.test import APIClient

client = APIClient()
client.post('/notes/', {'title': 'new idea'}, format='json')
</code></pre></div><p>要支持更多的请求格式集或更改默认格式，<a href="https://www.django-rest-framework.org/api-guide/testing/#configuration" target="_blank" rel="noopener noreferrer">请参阅“配置”部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="验证中"><a href="#验证中" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#authenticating" target="_blank" rel="noopener noreferrer">验证中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <h4 id="login-kwargs"><a href="#login-kwargs" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#loginkwargs" target="_blank" rel="noopener noreferrer">.login（** kwargs）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>该<code>login</code>方法的功能与Django的常规<code>Client</code>类完全相同。这样，您就可以针对包含的任何视图对请求进行身份验证<code>SessionAuthentication</code>。</p> <div class="language- extra-class"><pre class="language-text"><code># Make all requests in the context of a logged in session.
client = APIClient()
client.login(username='lauren', password='secret')
</code></pre></div><p>要注销，请<code>logout</code>照常调用该方法。</p> <div class="language- extra-class"><pre class="language-text"><code># Log out
client.logout()
</code></pre></div><p>该<code>login</code>方法适用于测试使用会话身份验证的API，例如包含与API进行AJAX交互的网站。</p> <h4 id="credentials-kwargs"><a href="#credentials-kwargs" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#credentialskwargs" target="_blank" rel="noopener noreferrer">.credentials（** kwargs）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>该<code>credentials</code>方法可用于设置标头，然后测试客户端会将其包含在所有后续请求中。</p> <div class="language- extra-class"><pre class="language-text"><code>from rest_framework.authtoken.models import Token
from rest_framework.test import APIClient

# Include an appropriate `Authorization:` header on all requests.
token = Token.objects.get(user__username='lauren')
client = APIClient()
client.credentials(HTTP_AUTHORIZATION='Token ' + token.key)
</code></pre></div><p>请注意，<code>credentials</code>第二次调用将覆盖所有现有凭据。您可以通过不带任何参数的方法来取消设置任何现有的凭据。</p> <div class="language- extra-class"><pre class="language-text"><code># Stop including any credentials
client.credentials()
</code></pre></div><p>该<code>credentials</code>方法适用于测试需要身份验证标头的API，例如基本身份验证，OAuth1a和OAuth2身份验证以及简单令牌身份验证方案。</p> <h4 id="force-authenticate-用户-无-令牌-无"><a href="#force-authenticate-用户-无-令牌-无" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#force_authenticateusernone-tokennone" target="_blank" rel="noopener noreferrer">.force_authenticate（用户=无，令牌=无）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>有时，您可能希望完全绕过身份验证，并强制将测试客户端的所有请求自动视为已身份验证。</p> <p>如果您正在测试API但又不想构造有效的身份验证凭据来发出测试请求，则这可能是一个有用的快捷方式。</p> <div class="language- extra-class"><pre class="language-text"><code>user = User.objects.get(username='lauren')
client = APIClient()
client.force_authenticate(user=user)
</code></pre></div><p>要取消对后续请求的<code>force_authenticate</code>身份验证，请调用将用户和/或令牌设置为<code>None</code>。</p> <div class="language- extra-class"><pre class="language-text"><code>client.force_authenticate(user=None)
</code></pre></div><h2 id="csrf验证"><a href="#csrf验证" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#csrf-validation" target="_blank" rel="noopener noreferrer">CSRF验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>默认情况下，使用时不应用CSRF验证<code>APIClient</code>。如果需要显式启用CSRF验证，则可以通过<code>enforce_csrf_checks</code>在实例化客户端时设置标志来实现。</p> <div class="language- extra-class"><pre class="language-text"><code>client = APIClient(enforce_csrf_checks=True)
</code></pre></div><p>与往常一样，CSRF验证仅适用于任何经过会话身份验证的视图。这意味着CSRF验证仅在通过调用登录了客户端后才会发生<code>login()</code>。</p> <hr> <h1 id="requestsclient"><a href="#requestsclient" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#requestsclient" target="_blank" rel="noopener noreferrer">RequestsClient<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>REST框架还包括一个客户端，用于使用流行的Python库与您的应用程序进行交互<code>requests</code>。这在以下情况下可能有用：</p> <ul><li>您期望主要通过另一个Python服务与API进行接口，并希望在与客户端将看到的相同级别上测试服务。</li> <li>您希望以这样的方式编写测试，使其也可以在暂存或实时环境中运行。（请参见下面的“实时测试”。）</li></ul> <p>这将显示与您直接使用请求会话完全相同的界面。</p> <div class="language- extra-class"><pre class="language-text"><code>from rest_framework.test import RequestsClient

client = RequestsClient()
response = client.get('http://testserver/users/')
assert response.status_code == 200
</code></pre></div><p>请注意，请求客户端要求您传递完全限定的URL。</p> <h2 id="requestsclient并使用数据库"><a href="#requestsclient并使用数据库" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#requestsclient-and-working-with-the-database" target="_blank" rel="noopener noreferrer">RequestsClient并使用数据库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>的<code>RequestsClient</code>，如果你想编写测试，是专为与服务界面交互类是有用的。这比使用标准Django测试客户端要严格一些，因为这意味着所有交互都应通过API进行。</p> <p>如果您正在使用<code>RequestsClient</code>，则需要确保测试设置和结果断言是作为常规API调用执行的，而不是直接与数据库模型进行交互。例如，与其检查<code>Customer.objects.count() == 3</code>您将列出客户终结点，并确保它包含三个记录，而不是检查。</p> <h2 id="标头和身份验证"><a href="#标头和身份验证" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#headers-authentication" target="_blank" rel="noopener noreferrer">标头和身份验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>可以使用与<a href="http://docs.python-requests.org/en/master/user/advanced/#session-objects" target="_blank" rel="noopener noreferrer">使用标准<code>requests.Session</code>实例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相同的方式来提供自定义标头和身份验证凭据。</p> <div class="language- extra-class"><pre class="language-text"><code>from requests.auth import HTTPBasicAuth

client.auth = HTTPBasicAuth('user', 'pass')
client.headers.update({'x-test': 'true'})
</code></pre></div><h2 id="csrf"><a href="#csrf" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#csrf" target="_blank" rel="noopener noreferrer">CSRF<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>如果你使用的<code>SessionAuthentication</code>，那么你就需要包括令牌任何一个CSRF <code>POST</code>，<code>PUT</code>，<code>PATCH</code>或<code>DELETE</code>请求。</p> <p>您可以按照基于JavaScript的客户端将使用的相同流程进行操作。首先发出<code>GET</code>请求以获取CRSF令牌，然后在随后的请求中出示该令牌。</p> <p>例如...</p> <div class="language- extra-class"><pre class="language-text"><code>client = RequestsClient()

# Obtain a CSRF token.
response = client.get('http://testserver/homepage/')
assert response.status_code == 200
csrftoken = response.cookies['csrftoken']

# Interact with the API.
response = client.post('http://testserver/organisations/', json={
    'name': 'MegaCorp',
    'status': 'active'
}, headers={'X-CSRFToken': csrftoken})
assert response.status_code == 200
</code></pre></div><h2 id="现场测试"><a href="#现场测试" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#live-tests" target="_blank" rel="noopener noreferrer">现场测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>通过仔细使用，<code>RequestsClient</code>和<code>CoreAPIClient</code>提供了编写测试用例的能力，这些用例可以在开发中运行，也可以直接在登台服务器或生产环境中运行。</p> <p>使用此样式创建一些核心功能的基本测试是验证实时服务的有效方法。这样做可能需要仔细注意设置和拆卸，以确保测试以不会直接影响客户数据的方式运行。</p> <hr> <h1 id="coreapiclient"><a href="#coreapiclient" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#coreapiclient" target="_blank" rel="noopener noreferrer">CoreAPIClient<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>CoreAPIClient允许您使用Python <code>coreapi</code>客户端库与您的API进行交互 。</p> <div class="language- extra-class"><pre class="language-text"><code># Fetch the API schema
client = CoreAPIClient()
schema = client.get('http://testserver/schema/')

# Create a new organisation
params = {'name': 'MegaCorp', 'status': 'active'}
client.action(schema, ['organisations', 'create'], params)

# Ensure that the organisation exists in the listing
data = client.action(schema, ['organisations', 'list'])
assert(len(data) == 1)
assert(data == [{'name': 'MegaCorp', 'status': 'active'}])
</code></pre></div><h2 id="标头和身份验证-2"><a href="#标头和身份验证-2" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#headers-authentication_1" target="_blank" rel="noopener noreferrer">标头和身份验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>自定义标头和身份验证的使用<code>CoreAPIClient</code>方式与相似<code>RequestsClient</code>。</p> <div class="language- extra-class"><pre class="language-text"><code>from requests.auth import HTTPBasicAuth

client = CoreAPIClient()
client.session.auth = HTTPBasicAuth('user', 'pass')
client.session.headers.update({'x-test': 'true'})
</code></pre></div><hr> <h1 id="api测试用例"><a href="#api测试用例" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#api-test-cases" target="_blank" rel="noopener noreferrer">API测试用例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>REST框架包括以下测试用例类，它们反映了现有的Django测试用例类，但使用<code>APIClient</code>而不是Django的default <code>Client</code>。</p> <ul><li><code>APISimpleTestCase</code></li> <li><code>APITransactionTestCase</code></li> <li><code>APITestCase</code></li> <li><code>APILiveServerTestCase</code></li></ul> <h2 id="例"><a href="#例" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#example" target="_blank" rel="noopener noreferrer">例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>您可以像使用常规Django测试用例类一样使用REST框架的任何用例类。该<code>self.client</code>属性将是一个<code>APIClient</code>实例。</p> <div class="language- extra-class"><pre class="language-text"><code>from django.urls import reverse
from rest_framework import status
from rest_framework.test import APITestCase
from myproject.apps.core.models import Account

class AccountTests(APITestCase):
    def test_create_account(self):
        &quot;&quot;&quot;
        Ensure we can create a new account object.
        &quot;&quot;&quot;
        url = reverse('account-list')
        data = {'name': 'DabApps'}
        response = self.client.post(url, data, format='json')
        self.assertEqual(response.status_code, status.HTTP_201_CREATED)
        self.assertEqual(Account.objects.count(), 1)
        self.assertEqual(Account.objects.get().name, 'DabApps')
</code></pre></div><hr> <h1 id="urlpatternstestcase"><a href="#urlpatternstestcase" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#urlpatternstestcase" target="_blank" rel="noopener noreferrer">URLPatternsTestCase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>REST框架还提供了一个测试用例类，<code>urlpatterns</code>以基于每个类进行隔离。请注意，这继承自Django的<code>SimpleTestCase</code>，很可能需要与另一个测试用例类混合使用。</p> <h2 id="例-2"><a href="#例-2" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#example_1" target="_blank" rel="noopener noreferrer">例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <div class="language- extra-class"><pre class="language-text"><code>from django.urls import include, path, reverse
from rest_framework.test import APITestCase, URLPatternsTestCase


class AccountTests(APITestCase, URLPatternsTestCase):
    urlpatterns = [
        path('api/', include('api.urls')),
    ]

    def test_create_account(self):
        &quot;&quot;&quot;
        Ensure we can create a new account object.
        &quot;&quot;&quot;
        url = reverse('account-list')
        response = self.client.get(url, format='json')
        self.assertEqual(response.status_code, status.HTTP_200_OK)
        self.assertEqual(len(response.data), 1)
</code></pre></div><hr> <h1 id="测试回应"><a href="#测试回应" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#testing-responses" target="_blank" rel="noopener noreferrer">测试回应<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h2 id="检查响应数据"><a href="#检查响应数据" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#checking-the-response-data" target="_blank" rel="noopener noreferrer">检查响应数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>在检查测试响应的有效性时，通常更方便的方法是检查创建响应的数据，而不是检查完全呈现的响应。</p> <p>例如，检查起来更容易<code>response.data</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>response = self.client.get('/users/4/')
self.assertEqual(response.data, {'id': 4, 'username': 'lauren'})
</code></pre></div><p>而不是检查解析结果<code>response.content</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>response = self.client.get('/users/4/')
self.assertEqual(json.loads(response.content), {'id': 4, 'username': 'lauren'})
</code></pre></div><h2 id="渲染回应"><a href="#渲染回应" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#rendering-responses" target="_blank" rel="noopener noreferrer">渲染回应<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>如果您直接使用来测试视图<code>APIRequestFactory</code>，则返回的响应将尚未呈现，因为模板响应的呈现是由Django的内部请求-响应周期执行的。为了进行访问<code>response.content</code>，您首先需要呈现响应。</p> <div class="language- extra-class"><pre class="language-text"><code>view = UserDetail.as_view()
request = factory.get('/users/4')
response = view(request, pk='4')
response.render()  # Cannot access `response.content` without this.
self.assertEqual(response.content, '{&quot;username&quot;: &quot;lauren&quot;, &quot;id&quot;: 4}')
</code></pre></div><hr> <h1 id="组态"><a href="#组态" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#configuration" target="_blank" rel="noopener noreferrer">组态<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <h2 id="设置默认格式"><a href="#设置默认格式" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#setting-the-default-format" target="_blank" rel="noopener noreferrer">设置默认格式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>可以使用<code>TEST_REQUEST_DEFAULT_FORMAT</code>设置键设置用于发出测试请求的默认格式。例如，要始终在默认情况下始终对测试请求使用JSON而不是标准的多部分表单请求，请在<code>settings.py</code>文件中设置以下内容：</p> <div class="language- extra-class"><pre class="language-text"><code>REST_FRAMEWORK = {
    ...
    'TEST_REQUEST_DEFAULT_FORMAT': 'json'
}
</code></pre></div><h2 id="设置可用格式"><a href="#设置可用格式" class="header-anchor">#</a> <a href="https://www.django-rest-framework.org/api-guide/testing/#setting-the-available-formats" target="_blank" rel="noopener noreferrer">设置可用格式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>如果您需要使用multipart或json请求之外的其他测试请求，则可以通过设置<code>TEST_REQUEST_RENDERER_CLASSES</code>设置来进行。</p> <p>例如，要增加对<code>format='html'</code>在测试请求中使用的支持，您的<code>settings.py</code>文件中可能会有类似的内容。</p> <div class="language- extra-class"><pre class="language-text"><code>REST_FRAMEWORK = {
    ...
    'TEST_REQUEST_RENDERER_CLASSES': [
        'rest_framework.renderers.MultiPartRenderer',
        'rest_framework.renderers.JSONRenderer',
        'rest_framework.renderers.TemplateHTMLRenderer'
    ]
}
</code></pre></div></div> <!----> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python/restFramework/26状态码.html" class="prev">
        状态码
      </a></span> <span class="next"><a href="/python/restFramework/28设置.html">
        设定值
      </a>
      →
    </span></p></div> <div class="page-footer"><ul class="inner"><li>Theme by <a href="https://github.com/qcyblm/vuepress-theme-vpx" title="本站主题" target="_blank" rel="noopener noreferrer">VPX</a></li> <li>Powered by <a href="https://www.vuepress.cn/" target="_blank" rel="noopener noreferrer">VuePress</a></li> <!----> <li>
      © 2018-2021
      <a href="https://xuqilong.top" target="_blank" rel="noopener noreferrer"> Copyright © 2021-present Qilong Xu © 2019 </a></li> <li><a href="https://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer"><!---->  粤ICP备19034953号-1
      </a></li> </ul></div> </main> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b8069efc.js" defer></script><script src="/assets/js/2.463f0d24.js" defer></script><script src="/assets/js/40.99b7368a.js" defer></script>
  </body>
</html>
