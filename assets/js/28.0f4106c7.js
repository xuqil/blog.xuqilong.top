(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{409:function(t,a,s){"use strict";s.r(a);var e=s(11),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"节流"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#节流"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#throttling",target:"_blank",rel:"noopener noreferrer"}},[t._v("节流"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("HTTP / 1.1 420增强镇静")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.twitter.com/en/docs/basics/rate-limiting",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twitter API速率限制响应"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("节流类似于"),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/permissions/",target:"_blank",rel:"noopener noreferrer"}},[t._v("权限"),s("OutboundLink")],1),t._v("，它确定是否应授权请求。节流指示临时状态，并用于控制客户端可以向API发出的请求的速率。")]),t._v(" "),s("p",[t._v("与权限一样，可以使用多个调节器。您的API可能会对未经身份验证的请求进行限制，而对于经过身份验证的请求则进行限制较少。")]),t._v(" "),s("p",[t._v("您可能要使用多个调节器的另一种情况是，由于某些服务特别耗费资源，因此您需要在API的不同部分施加不同的约束。")]),t._v(" "),s("p",[t._v("如果要同时施加突发节流率和持续节流率，也可以使用多个节气门。例如，您可能希望将用户限制为每分钟最多60个请求，每天最多1000个请求。")]),t._v(" "),s("p",[t._v("节流阀不一定仅指速率限制请求。例如，存储服务可能还需要限制带宽，而付费数据服务可能需要限制一定数量的正在访问的记录。")]),t._v(" "),s("h2",{attrs:{id:"节流如何确定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#节流如何确定"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#how-throttling-is-determined",target:"_blank",rel:"noopener noreferrer"}},[t._v("节流如何确定"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("与权限和身份验证一样，REST框架中的限制始终定义为类列表。")]),t._v(" "),s("p",[t._v("在运行视图主体之前，请检查列表中的每个油门。如果任何油门检查失败，"),s("code",[t._v("exceptions.Throttled")]),t._v("将引发异常，并且视图主体将不运行。")]),t._v(" "),s("h2",{attrs:{id:"设定节流政策"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设定节流政策"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#setting-the-throttling-policy",target:"_blank",rel:"noopener noreferrer"}},[t._v("设定节流政策"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("可以使用"),s("code",[t._v("DEFAULT_THROTTLE_CLASSES")]),t._v("和"),s("code",[t._v("DEFAULT_THROTTLE_RATES")]),t._v("设置全局设置默认的限制策略。例如。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("REST_FRAMEWORK "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_CLASSES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.AnonRateThrottle'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.UserRateThrottle'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'anon'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100/day'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1000/day'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("中所用的速率的描述"),s("code",[t._v("DEFAULT_THROTTLE_RATES")]),t._v("可以包括"),s("code",[t._v("second")]),t._v("，"),s("code",[t._v("minute")]),t._v("，"),s("code",[t._v("hour")]),t._v("或"),s("code",[t._v("day")]),t._v("作为节流段。")]),t._v(" "),s("p",[t._v("您还可以使用"),s("code",[t._v("APIView")]),t._v("基于类的视图基于每个视图或每个视图集设置节流策略。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("response "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Response\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("throttling "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UserRateThrottle\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("views "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" APIView\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExampleView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    throttle_classes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UserRateThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        content "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'status'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request was permitted'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("或者，如果您将"),s("code",[t._v("@api_view")]),t._v("装饰器与基于函数的视图一起使用。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@api_view")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@throttle_classes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UserRateThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("example_view")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    content "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'status'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request was permitted'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"如何识别客户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何识别客户"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#how-clients-are-identified",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何识别客户"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("的"),s("code",[t._v("X-Forwarded-For")]),t._v("HTTP报头和"),s("code",[t._v("REMOTE_ADDR")]),t._v("WSGI变量被用来唯一地标识为节流客户端的IP地址。如果存在"),s("code",[t._v("X-Forwarded-For")]),t._v("标头，则将使用它，否则"),s("code",[t._v("REMOTE_ADDR")]),t._v("将使用WSGI环境中的变量值。")]),t._v(" "),s("p",[t._v("如果需要严格标识唯一的客户端IP地址，则需要先通过设置"),s("code",[t._v("NUM_PROXIES")]),t._v("设置配置API落后的应用代理数量。此设置应为零或更大的整数。如果设置为非零，则"),s("code",[t._v("X-Forwarded-For")]),t._v("一旦首次排除任何应用程序代理IP地址，客户端IP将被标识为标头中的最后一个IP地址。如果设置为零，则该"),s("code",[t._v("REMOTE_ADDR")]),t._v("值将始终用作标识IP地址。")]),t._v(" "),s("p",[t._v("重要的是要了解，如果您配置此"),s("code",[t._v("NUM_PROXIES")]),t._v("设置，则唯一"),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Network_address_translation",target:"_blank",rel:"noopener noreferrer"}},[t._v("经过NAT转换的"),s("OutboundLink")],1),t._v("网关后面的所有客户端都将被视为单个客户端。")]),t._v(" "),s("p",[s("code",[t._v("X-Forwarded-For")]),t._v("您可以"),s("a",{attrs:{href:"http://oxpedia.org/wiki/index.php?title=AppSuite:Grizzly#Multiple_Proxies_in_front_of_the_cluster",target:"_blank",rel:"noopener noreferrer"}},[t._v("在此处找到"),s("OutboundLink")],1),t._v("有关标头如何工作以及标识远程客户端IP的更多上下文。")]),t._v(" "),s("h2",{attrs:{id:"设置缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置缓存"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#setting-up-the-cache",target:"_blank",rel:"noopener noreferrer"}},[t._v("设置缓存"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("REST框架提供的节流类使用Django的缓存后端。您应该确保已设置适当的"),s("a",{attrs:{href:"https://docs.djangoproject.com/en/stable/ref/settings/#caches",target:"_blank",rel:"noopener noreferrer"}},[t._v("缓存设置"),s("OutboundLink")],1),t._v("。"),s("code",[t._v("LocMemCache")]),t._v("对于简单的设置，后端的默认值应该可以。有关更多详细信息，请参见Django的"),s("a",{attrs:{href:"https://docs.djangoproject.com/en/stable/topics/cache/#setting-up-the-cache",target:"_blank",rel:"noopener noreferrer"}},[t._v("缓存文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("如果您需要使用以外的其他缓存"),s("code",[t._v("'default'")]),t._v("，则可以通过创建自定义的油门类并设置"),s("code",[t._v("cache")]),t._v("属性来实现。例如：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" django"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" caches\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomAnonRateThrottle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AnonRateThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alternate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("您需要记住还要在"),s("code",[t._v("'DEFAULT_THROTTLE_CLASSES'")]),t._v("设置键或使用"),s("code",[t._v("throttle_classes")]),t._v("view属性中设置自定义油门类。")]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"api参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api参考"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#api-reference",target:"_blank",rel:"noopener noreferrer"}},[t._v("API参考"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"anonratethrottle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#anonratethrottle"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#anonratethrottle",target:"_blank",rel:"noopener noreferrer"}},[t._v("AnonRateThrottle"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("该"),s("code",[t._v("AnonRateThrottle")]),t._v("会永远只能扼杀未经授权的用户。传入请求的IP地址用于生成唯一的密钥以进行限制。")]),t._v(" "),s("p",[t._v("允许的请求速率由以下之一确定（按优先顺序）。")]),t._v(" "),s("ul",[s("li",[t._v("所述"),s("code",[t._v("rate")]),t._v("的类，其可以通过覆盖被提供的属性"),s("code",[t._v("AnonRateThrottle")]),t._v("和设置属性。")]),t._v(" "),s("li",[t._v("该"),s("code",[t._v("DEFAULT_THROTTLE_RATES['anon']")]),t._v("设置。")])]),t._v(" "),s("p",[s("code",[t._v("AnonRateThrottle")]),t._v(" 如果您想限制来自未知来源的请求速率，则适用。")]),t._v(" "),s("h2",{attrs:{id:"userratethrottle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#userratethrottle"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#userratethrottle",target:"_blank",rel:"noopener noreferrer"}},[t._v("UserRateThrottle"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("UserRateThrottle")]),t._v("将油门用户跨API请求给定的速度。用户ID用于生成唯一的密钥以进行限制。未经身份验证的请求将退回到使用传入请求的IP地址来生成唯一密钥以进行限制。")]),t._v(" "),s("p",[t._v("允许的请求速率由以下之一确定（按优先顺序）。")]),t._v(" "),s("ul",[s("li",[t._v("所述"),s("code",[t._v("rate")]),t._v("的类，其可以通过覆盖被提供的属性"),s("code",[t._v("UserRateThrottle")]),t._v("和设置属性。")]),t._v(" "),s("li",[t._v("该"),s("code",[t._v("DEFAULT_THROTTLE_RATES['user']")]),t._v("设置。")])]),t._v(" "),s("p",[t._v("一个API可能同时具有多个"),s("code",[t._v("UserRateThrottles")]),t._v("位置。为此，请"),s("code",[t._v("UserRateThrottle")]),t._v("为每个类重写并设置一个唯一的“作用域”。")]),t._v(" "),s("p",[t._v("例如，可以使用以下类来实现多个用户节流率。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BurstRateThrottle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserRateThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    scope "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'burst'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SustainedRateThrottle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserRateThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    scope "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sustained'")]),t._v("\n")])])]),s("p",[t._v("...以及以下设置。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("REST_FRAMEWORK "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_CLASSES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.throttles.BurstRateThrottle'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.throttles.SustainedRateThrottle'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'burst'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'60/min'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sustained'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1000/day'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("UserRateThrottle")]),t._v(" 如果您希望对每个用户进行简单的全局速率限制，则适用。")]),t._v(" "),s("h2",{attrs:{id:"scopedratethrottle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scopedratethrottle"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#scopedratethrottle",target:"_blank",rel:"noopener noreferrer"}},[t._v("ScopedRateThrottle"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("的"),s("code",[t._v("ScopedRateThrottle")]),t._v("类可用于限制访问API的特定部分。仅当所访问的视图包含"),s("code",[t._v(".throttle_scope")]),t._v("属性时，才会应用此限制。然后，通过将请求的“范围”与唯一的用户ID或IP地址串联起来，即可形成唯一的限制键。")]),t._v(" "),s("p",[t._v("允许的请求速率由"),s("code",[t._v("DEFAULT_THROTTLE_RATES")]),t._v("设置使用请求“范围”中的键确定。")]),t._v(" "),s("p",[t._v("例如，给定以下视图...")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContactListView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    throttle_scope "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'contacts'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContactDetailView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    throttle_scope "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'contacts'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UploadView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("APIView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    throttle_scope "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uploads'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("...以及以下设置。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("REST_FRAMEWORK "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_CLASSES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rest_framework.throttling.ScopedRateThrottle'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DEFAULT_THROTTLE_RATES'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'contacts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1000/day'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uploads'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'20/day'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("用户每天对一个请求的请求"),s("code",[t._v("ContactListView")]),t._v("或"),s("code",[t._v("ContactDetailView")]),t._v("将被限制为总共1000个请求。用户对的请求"),s("code",[t._v("UploadView")]),t._v("将被限制为每天20个请求。")]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"定制油门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定制油门"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#custom-throttles",target:"_blank",rel:"noopener noreferrer"}},[t._v("定制油门"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("要创建自定义节流阀，请覆盖"),s("code",[t._v("BaseThrottle")]),t._v("并实施"),s("code",[t._v(".allow_request(self, request, view)")]),t._v("。"),s("code",[t._v("True")]),t._v("如果应允许该请求，则该方法应返回，"),s("code",[t._v("False")]),t._v("否则返回。")]),t._v(" "),s("p",[t._v("（可选）您也可以覆盖该"),s("code",[t._v(".wait()")]),t._v("方法。如果已实施，"),s("code",[t._v(".wait()")]),t._v("则应返回建议的秒数，以等待下一个请求，或者"),s("code",[t._v("None")]),t._v("。"),s("code",[t._v(".wait()")]),t._v("如果"),s("code",[t._v(".allow_request()")]),t._v("先前已返回，则将仅调用该方法"),s("code",[t._v("False")]),t._v("。")]),t._v(" "),s("p",[t._v("如果该"),s("code",[t._v(".wait()")]),t._v("方法已实现且请求已被限制，则"),s("code",[t._v("Retry-After")]),t._v("标头将包含在响应中。")]),t._v(" "),s("h2",{attrs:{id:"例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/throttling/#example",target:"_blank",rel:"noopener noreferrer"}},[t._v("例"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("以下是速率调节的示例，它将在每10个请求中随机调节1个。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" random\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RandomRateThrottle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("throttling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BaseThrottle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("allow_request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("randint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);