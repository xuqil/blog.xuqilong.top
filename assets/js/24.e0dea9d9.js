(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{405:function(t,a,s){"use strict";s.r(a);var e=s(11),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"验证者"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证者"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#validators",target:"_blank",rel:"noopener noreferrer"}},[t._v("验证者"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("验证器对于在不同类型的字段之间重用验证逻辑很有用。")]),t._v(" "),s("p",[t._v("— "),s("a",{attrs:{href:"https://docs.djangoproject.com/en/stable/ref/validators/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Django文档"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("在大多数情况下，您在REST框架中处理验证时，您将仅依赖于默认字段验证，或者在序列化程序或字段类上编写显式验证方法。")]),t._v(" "),s("p",[t._v("但是，有时您希望将验证逻辑放入可重用的组件中，以便可以轻松地在整个代码库中重用它。这可以通过使用验证器函数和验证器类来实现。")]),t._v(" "),s("h2",{attrs:{id:"rest框架中的验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rest框架中的验证"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#validation-in-rest-framework",target:"_blank",rel:"noopener noreferrer"}},[t._v("REST框架中的验证"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Django REST框架序列化程序中的验证与Django "),s("code",[t._v("ModelForm")]),t._v("类中的验证工作方式略有不同。")]),t._v(" "),s("p",[t._v("与"),s("code",[t._v("ModelForm")]),t._v("所述验证形式的上部分地执行，并且部分地在模型实例。使用REST框架，验证完全在序列化程序类上执行。由于以下原因，这是有利的：")]),t._v(" "),s("ul",[s("li",[t._v("它引入了适当的关注点分离，使您的代码行为更加明显。")]),t._v(" "),s("li",[t._v("在使用快捷方式"),s("code",[t._v("ModelSerializer")]),t._v("类和使用显式"),s("code",[t._v("Serializer")]),t._v("类之间进行切换很容易。用于的任何验证行为"),s("code",[t._v("ModelSerializer")]),t._v("都很容易复制。")]),t._v(" "),s("li",[t._v("打印"),s("code",[t._v("repr")]),t._v("序列化程序实例的，将确切显示它适用的验证规则。在模型实例上没有调用任何额外的隐藏验证行为。")])]),t._v(" "),s("p",[t._v("使用时，"),s("code",[t._v("ModelSerializer")]),t._v("所有这些都会自动为您处理。如果要改为使用"),s("code",[t._v("Serializer")]),t._v("类，则需要显式定义验证规则。")]),t._v(" "),s("h4",{attrs:{id:"例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#example",target:"_blank",rel:"noopener noreferrer"}},[t._v("例"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("作为REST框架如何使用显式验证的示例，我们将使用一个简单的模型类，该类具有一个具有唯一性约束的字段。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomerReportRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    time_raised "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateTimeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("timezone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" editable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    reference "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CharField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unique"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_length"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    description "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" models"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TextField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这"),s("code",[t._v("ModelSerializer")]),t._v("是我们可以用来创建或更新实例的基础"),s("code",[t._v("CustomerReportRecord")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomerReportSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        model "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CustomerReportRecord\n")])])]),s("p",[t._v("如果我们使用以下方法打开Django shell，"),s("code",[t._v("manage.py shell")]),t._v("我们现在可以")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" project"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serializers "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CustomerReportSerializer\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" serializer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CustomerReportSerializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("repr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nCustomerReportSerializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("id")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" IntegerField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("label"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ID'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" read_only"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    time_raised "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DateTimeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("read_only"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    reference "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CharField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("max_length"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" validators"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("UniqueValidator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queryset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("CustomerReportRecord"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    description "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CharField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'textarea'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这里有趣的是"),s("code",[t._v("reference")]),t._v("领域。我们可以看到，唯一性约束是由序列化器字段上的验证器显式实施的。")]),t._v(" "),s("p",[t._v("由于这种更明确的样式，REST框架包含了一些验证器类，而这些验证器类在核心Django中不可用。这些类在下面详细介绍。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"uniquevalidator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uniquevalidator"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#uniquevalidator",target:"_blank",rel:"noopener noreferrer"}},[t._v("UniqueValidator"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("该验证器可用于"),s("code",[t._v("unique=True")]),t._v("对模型字段实施约束。它带有一个必需的参数和一个可选的"),s("code",[t._v("messages")]),t._v("参数：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("queryset")]),t._v(" "),s("em",[t._v("必需")]),t._v(" -这是应针对其强制执行唯一性的查询集。")]),t._v(" "),s("li",[s("code",[t._v("message")]),t._v(" -验证失败时应使用的错误消息。")]),t._v(" "),s("li",[s("code",[t._v("lookup")]),t._v("-用于查找具有已验证值的现有实例的查找。默认为"),s("code",[t._v("'exact'")]),t._v("。")])]),t._v(" "),s("p",[t._v("该验证器应应用于"),s("em",[t._v("序列化器字段")]),t._v("，如下所示：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validators "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UniqueValidator\n\nslug "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SlugField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    max_length"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    validators"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("UniqueValidator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queryset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("BlogPost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"uniquetogethervalidator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uniquetogethervalidator"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#uniquetogethervalidator",target:"_blank",rel:"noopener noreferrer"}},[t._v("UniqueTogetherValidator"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("该验证器可用于"),s("code",[t._v("unique_together")]),t._v("对模型实例施加约束。它具有两个必需参数和一个可选"),s("code",[t._v("messages")]),t._v("参数：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("queryset")]),t._v(" "),s("em",[t._v("必需")]),t._v(" -这是应针对其强制执行唯一性的查询集。")]),t._v(" "),s("li",[s("code",[t._v("fields")]),t._v(" "),s("em",[t._v("必填")]),t._v(" -字段名称的列表或元组，应组成唯一的集合。这些必须作为字段存在于序列化程序类中。")]),t._v(" "),s("li",[s("code",[t._v("message")]),t._v(" -验证失败时应使用的错误消息。")])]),t._v(" "),s("p",[t._v("验证器应应用于"),s("em",[t._v("序列化器类")]),t._v("，如下所示：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validators "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UniqueTogetherValidator\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExampleSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ToDo items belong to a parent list, and have an ordering defined")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# by the 'position' field. No two items in a given list may share")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the same position.")]),t._v("\n        validators "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            UniqueTogetherValidator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                queryset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ToDoItem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                fields"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'position'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("注意")]),t._v("："),s("code",[t._v("UniqueTogetherValidator")]),t._v("该类始终强加一个隐式约束，该类所应用的所有字段始终按要求处理。带有"),s("code",[t._v("default")]),t._v("值的字段是一个例外，因为即使从用户输入中省略，它们也始终提供一个值。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"uniquefordatevalidator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uniquefordatevalidator"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#uniquefordatevalidator",target:"_blank",rel:"noopener noreferrer"}},[t._v("UniqueForDateValidator"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"uniqueformonthvalidator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uniqueformonthvalidator"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#uniqueformonthvalidator",target:"_blank",rel:"noopener noreferrer"}},[t._v("UniqueForMonthValidator"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"uniqueforyearvalidator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uniqueforyearvalidator"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#uniqueforyearvalidator",target:"_blank",rel:"noopener noreferrer"}},[t._v("UniqueForYearValidator"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("这些验证可用于执行"),s("code",[t._v("unique_for_date")]),t._v("，"),s("code",[t._v("unique_for_month")]),t._v("和"),s("code",[t._v("unique_for_year")]),t._v("上模型实例的限制。他们采用以下参数：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("queryset")]),t._v(" "),s("em",[t._v("必需")]),t._v(" -这是应针对其强制执行唯一性的查询集。")]),t._v(" "),s("li",[s("code",[t._v("field")]),t._v(" "),s("em",[t._v("必填")]),t._v(" -将验证给定日期范围内的唯一性的字段名称。它必须作为序列化程序类上的字段存在。")]),t._v(" "),s("li",[s("code",[t._v("date_field")]),t._v(" "),s("em",[t._v("required-必填")]),t._v("字段名称，用于确定唯一性约束的日期范围。它必须作为序列化程序类上的字段存在。")]),t._v(" "),s("li",[s("code",[t._v("message")]),t._v(" -验证失败时应使用的错误消息。")])]),t._v(" "),s("p",[t._v("验证器应应用于"),s("em",[t._v("序列化器类")]),t._v("，如下所示：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" rest_framework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("validators "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" UniqueForYearValidator\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExampleSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Blog posts should have a slug that is unique for the current year.")]),t._v("\n        validators "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            UniqueForYearValidator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                queryset"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("BlogPostItem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                field"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'slug'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                date_field"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'published'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("始终要求序列号类上存在用于验证的日期字段。您不能简单地依赖模型类"),s("code",[t._v("default=...")]),t._v("，因为直到运行验证之后，才会生成用于默认值的值。")]),t._v(" "),s("p",[t._v("您可能要使用两种样式，具体取决于您希望API的行为方式。如果您正在使用"),s("code",[t._v("ModelSerializer")]),t._v("，则可能仅依赖于REST框架为您生成的默认值，但是如果您正在使用"),s("code",[t._v("Serializer")]),t._v("或仅希望进行更明确的控制，请使用下面演示的样式。")]),t._v(" "),s("h4",{attrs:{id:"与可写日期字段一起使用。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#与可写日期字段一起使用。"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#using-with-a-writable-date-field",target:"_blank",rel:"noopener noreferrer"}},[t._v("与可写日期字段一起使用。"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果您希望日期字段可写，则唯一需要注意的是，您应该通过设置"),s("code",[t._v("default")]),t._v("参数或通过设置来确保输入数据中日期字段始终可用"),s("code",[t._v("required=True")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("published "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateTimeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("required"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"与只读日期字段一起使用。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#与只读日期字段一起使用。"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#using-with-a-read-only-date-field",target:"_blank",rel:"noopener noreferrer"}},[t._v("与只读日期字段一起使用。"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果希望日期字段可见，但用户不可编辑，则设置"),s("code",[t._v("read_only=True")]),t._v("并另外设置一个"),s("code",[t._v("default=...")]),t._v("参数。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("published "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateTimeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("read_only"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("timezone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"与隐藏的日期字段一起使用。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#与隐藏的日期字段一起使用。"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#using-with-a-hidden-date-field",target:"_blank",rel:"noopener noreferrer"}},[t._v("与隐藏的日期字段一起使用。"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果您希望日期字段对用户完全隐藏，请使用"),s("code",[t._v("HiddenField")]),t._v("。此字段类型不接受用户输入，而是始终将其默认值返回给"),s("code",[t._v("validated_data")]),t._v("序列化器中的。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("published "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HiddenField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("timezone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("注意")]),t._v("：这些"),s("code",[t._v("UniqueForValidator")]),t._v("类强加了一个隐式约束，即始终将按其要求应用它们的字段。带有"),s("code",[t._v("default")]),t._v("值的字段是一个例外，因为即使从用户输入中省略，它们也始终提供一个值。")]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"高级字段默认值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高级字段默认值"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#advanced-field-defaults",target:"_blank",rel:"noopener noreferrer"}},[t._v("高级字段默认值"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("了在串行化器在多个领域得到应用验证有时可以要求不应该由API客户端被提供一个字段输入，但"),s("em",[t._v("是")]),t._v("可作为输入提供给验证器。")]),t._v(" "),s("p",[t._v("您可能要用于这种验证的两种模式包括：")]),t._v(" "),s("ul",[s("li",[t._v("使用"),s("code",[t._v("HiddenField")]),t._v("。该字段将出现在串行器输出表示中，"),s("code",[t._v("validated_data")]),t._v("但"),s("em",[t._v("将不")]),t._v("使用。")]),t._v(" "),s("li",[t._v("与一起使用标准字段"),s("code",[t._v("read_only=True")]),t._v("，但其中还包含一个"),s("code",[t._v("default=…")]),t._v("参数。该字段"),s("em",[t._v("将")]),t._v("在序列化器输出表示中使用，但不能由用户直接设置。")])]),t._v(" "),s("p",[t._v("REST框架包含一些默认设置，它们在这种情况下可能很有用。")]),t._v(" "),s("h4",{attrs:{id:"currentuserdefault"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#currentuserdefault"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#currentuserdefault",target:"_blank",rel:"noopener noreferrer"}},[t._v("CurrentUserDefault"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("可用于表示当前用户的默认类。为了使用此功能，在实例化序列化程序时，必须已将“请求”作为上下文字典的一部分提供。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HiddenField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CurrentUserDefault"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"createonlydefault"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#createonlydefault"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#createonlydefault",target:"_blank",rel:"noopener noreferrer"}},[t._v("CreateOnlyDefault"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("只能用于"),s("em",[t._v("在创建操作期间设置默认参数")]),t._v("的默认类。在更新期间，该字段被忽略。")]),t._v(" "),s("p",[t._v("它带有一个参数，这是在创建操作期间应使用的默认值或可调用参数。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("created_at "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateTimeField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    default"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreateOnlyDefault"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timezone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("now"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h1",{attrs:{id:"验证者的局限性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证者的局限性"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#limitations-of-validators",target:"_blank",rel:"noopener noreferrer"}},[t._v("验证者的局限性"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在某些模棱两可的情况下，您将需要显式地处理验证，而不是依赖于所"),s("code",[t._v("ModelSerializer")]),t._v("生成的默认序列化器类 。")]),t._v(" "),s("p",[t._v("在这些情况下，您可能需要通过为序列化程序"),s("code",[t._v("Meta.validators")]),t._v("属性指定一个空列表来禁用自动生成的验证器。")]),t._v(" "),s("h2",{attrs:{id:"选填栏位"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选填栏位"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#optional-fields",target:"_blank",rel:"noopener noreferrer"}},[t._v("选填栏位"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("默认情况下，“唯一在一起”验证将强制所有字段均为 "),s("code",[t._v("required=True")]),t._v("。在某些情况下，您可能希望显式应用 "),s("code",[t._v("required=False")]),t._v("到其中一个字段，在这种情况下，所需的验证行为是不明确的。")]),t._v(" "),s("p",[t._v("在这种情况下，通常将需要从序列化器类中排除验证器，而是在"),s("code",[t._v(".validate()")]),t._v("方法或视图中显式编写任何验证逻辑。")]),t._v(" "),s("p",[t._v("例如：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BillingRecordSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModelSerializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" attrs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply custom validation either here, or in the view.")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Meta")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        fields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'client'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'date'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'amount'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        extra_kwargs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'client'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'required'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        validators "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Remove a default "unique together" constraint.')]),t._v("\n")])])]),s("h2",{attrs:{id:"更新嵌套的序列化器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新嵌套的序列化器"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#updating-nested-serializers",target:"_blank",rel:"noopener noreferrer"}},[t._v("更新嵌套的序列化器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("将更新应用于现有实例时，唯一性验证器会将当前实例从唯一性检查中排除。当前实例在唯一性检查的上下文中可用，因为它是"),s("code",[t._v("instance=...")]),t._v("实例化序列化程序时最初使用的传递给序列化程序的属性 。")]),t._v(" "),s("p",[t._v("对于"),s("em",[t._v("嵌套")]),t._v("序列化程序的更新操作，由于实例不可用，因此无法应用此排除。")]),t._v(" "),s("p",[t._v("同样，您可能想要从序列化器类中显式删除验证器，并在"),s("code",[t._v(".validate()")]),t._v("方法或视图中显式编写验证约束的代码。")]),t._v(" "),s("h2",{attrs:{id:"调试复杂案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调试复杂案例"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#debugging-complex-cases",target:"_blank",rel:"noopener noreferrer"}},[t._v("调试复杂案例"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果不确定某个"),s("code",[t._v("ModelSerializer")]),t._v("类将产生什么样的行为，通常最好运行一个"),s("code",[t._v("manage.py shell")]),t._v("，并打印一个序列化器的实例，以便您可以检查它为您自动生成的字段和验证器。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" serializer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MyComplexModelSerializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyComplexModelSerializer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    my_fields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("还请记住，在复杂的情况下，通常最好是显式定义序列化程序类，而不是依赖于默认 "),s("code",[t._v("ModelSerializer")]),t._v("行为。这涉及更多代码，但可以确保结果行为更加透明。")]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"编写自定义验证器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写自定义验证器"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#writing-custom-validators",target:"_blank",rel:"noopener noreferrer"}},[t._v("编写自定义验证器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("您可以使用Django现有的任何验证器，也可以编写自己的自定义验证器。")]),t._v(" "),s("h2",{attrs:{id:"基于功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于功能"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#function-based",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于功能"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("验证器可以是引发"),s("code",[t._v("serializers.ValidationError")]),t._v("失败的任何可调用对象。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("even_number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ValidationError"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This field must be an even number.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"现场级验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#现场级验证"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#field-level-validation",target:"_blank",rel:"noopener noreferrer"}},[t._v("现场级验证"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("您可以通过向子类中添加"),s("code",[t._v(".validate_")]),t._v("方法来指定自定义字段级验证"),s("code",[t._v("Serializer")]),t._v("。这在 "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/serializers/#field-level-validation",target:"_blank",rel:"noopener noreferrer"}},[t._v("Serializer文档中有记录"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"基于类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于类"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#class-based",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于类"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("要编写基于类的验证器，请使用"),s("code",[t._v("__call__")]),t._v("方法。基于类的验证器非常有用，因为它们允许您参数化和重用行为。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultipleOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__init__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" base"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__call__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This field must be a multiple of %d.'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("base\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" serializers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ValidationError"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"访问上下文"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问上下文"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://www.django-rest-framework.org/api-guide/validators/#accessing-the-context",target:"_blank",rel:"noopener noreferrer"}},[t._v("访问上下文"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("在某些高级情况下，您可能希望将验证器传递给与其他上下文一起使用的序列化器字段。您可以通过"),s("code",[t._v("requires_context = True")]),t._v("在验证器上设置属性来实现。"),s("code",[t._v("__call__")]),t._v("然后，将使用"),s("code",[t._v("serializer_field")]),t._v(" 或"),s("code",[t._v("serializer")]),t._v("作为附加参数调用该方法。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("requires_context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__call__")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serializer_field"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);