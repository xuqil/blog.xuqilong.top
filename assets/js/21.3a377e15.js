(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{401:function(t,a,s){"use strict";s.r(a);var n=s(11),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"streams"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#streams"}},[t._v("#")]),t._v(" streams")]),t._v(" "),s("p",[t._v("流是用于处理网络连接的支持 async/await 的高层级原语。 流允许发送和接收数据，而不需要使用回调或低级协议和传输。")]),t._v(" "),s("h2",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("ul",[s("li",[s("h3",{attrs:{id:"使用流的-tcp-回显客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用流的-tcp-回显客户端"}},[t._v("#")]),t._v(" 使用流的 TCP 回显客户端")]),t._v(" "),s("p",[t._v("下面是一个使用 asyncio streams 编写的 TCP echo 客户端示例:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncio\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tcp_echo_client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" writer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'Send: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token conversion-option punctuation"}},[t._v("!r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'Received: ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token conversion-option punctuation"}},[t._v("!r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Close the connection'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nasyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tcp_echo_client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World!'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("**参见：**使用低层级 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_connection",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("loop.create_connection()")]),s("OutboundLink")],1),t._v(" 方法的 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-protocol.html#asyncio-example-tcp-echo-client-protocol",target:"_blank",rel:"noopener noreferrer"}},[t._v("TCP 回显客户端协议"),s("OutboundLink")],1),t._v(" 示例。")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"使用流的-tcp-回显服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用流的-tcp-回显服务器"}},[t._v("#")]),t._v(" 使用流的 TCP 回显服务器")]),t._v(" "),s("p",[t._v("TCP 回显服务器使用 "),s("code",[t._v("asyncio.start_server()")]),t._v(" 函数:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncio\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle_echo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    addr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_extra_info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'peername'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Received ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token conversion-option punctuation"}},[t._v("!r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(" from ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token conversion-option punctuation"}},[t._v("!r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Send: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token conversion-option punctuation"}},[t._v("!r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Close the connection"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start_server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        handle_echo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    addr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sockets"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getsockname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'Serving on ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serve_forever"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nasyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("blockquote",[s("p",[s("strong",[t._v("参见")]),t._v("：使用 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_server",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("loop.create_server()")]),s("OutboundLink")],1),t._v(" 方法的 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-protocol.html#asyncio-example-tcp-echo-server-protocol",target:"_blank",rel:"noopener noreferrer"}},[t._v("TCP 回显服务器协议"),s("OutboundLink")],1),t._v(" 示例。")])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"获取-http-标头"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取-http-标头"}},[t._v("#")]),t._v(" 获取 HTTP 标头")]),t._v(" "),s("p",[t._v("查询命令行传入 URL 的 HTTP 标头的简单示例:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncio\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" urllib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print_http_headers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    url "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" urllib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("urlsplit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scheme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" writer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ssl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" writer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"HEAD ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("or")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' HTTP/1.0\\r\\n"')])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"Host: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\\r\\n"')])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\r\\n"')])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin-1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        line "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n\n        line "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'latin1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rstrip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("f'HTTP header> ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ignore the body, close the socket")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nurl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nasyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("print_http_headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("用法:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("python example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n")])])]),s("p",[t._v("或使用 HTTPS:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("python example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("example"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("page"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n")])])])]),t._v(" "),s("li",[s("h3",{attrs:{id:"注册一个打开的套接字以等待使用流的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册一个打开的套接字以等待使用流的数据"}},[t._v("#")]),t._v(" 注册一个打开的套接字以等待使用流的数据")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("open_connection()")]),t._v(" 函数实现等待直到套接字接收到数据的协程:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wait_for_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Get a reference to the current event loop because")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# we want to access low-level APIs.")]),t._v("\n    loop "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_running_loop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a pair of connected sockets.")]),t._v("\n    rsock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wsock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socketpair"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Register the open socket to wait for data.")]),t._v("\n    reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" writer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" asyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("open_connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sock"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rsock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Simulate the reception of data from the network")]),t._v("\n    loop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call_soon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wsock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Wait for data")]),t._v("\n    data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Got data, we are done: close the socket")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Received:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Close the second socket")]),t._v("\n    wsock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nasyncio"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wait_for_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("blockquote",[s("p",[s("strong",[t._v("参见")]),t._v("：使用低层级协议以及 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.create_connection",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("loop.create_connection()")]),s("OutboundLink")],1),t._v(" 方法的 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-protocol.html#asyncio-example-create-connection",target:"_blank",rel:"noopener noreferrer"}},[t._v("注册一个打开的套接字以等待使用协议的数据"),s("OutboundLink")],1),t._v(" 示例。")]),t._v(" "),s("p",[t._v("使用低层级的 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio.loop.add_reader",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("loop.add_reader()")]),s("OutboundLink")],1),t._v(" 方法来监视文件描述符的 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-eventloop.html#asyncio-example-watch-fd",target:"_blank",rel:"noopener noreferrer"}},[t._v("监视文件描述符以读取事件"),s("OutboundLink")],1),t._v(" 示例。")])])])]),t._v(" "),s("h2",{attrs:{id:"stream-函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stream-函数"}},[t._v("#")]),t._v(" Stream 函数")]),t._v(" "),s("p",[t._v("下面的高级 asyncio 函数可以用来创建和处理流:")]),t._v(" "),s("h3",{attrs:{id:"asyncio-open-connection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asyncio-open-connection"}},[t._v("#")]),t._v(" "),s("code",[t._v("asyncio.open_connection")])]),t._v(" "),s("p",[s("code",[t._v("coroutine asyncio.open_connection(host=None, port=None, *, loop=None, limit=None, ssl=None, family=0, proto=0, flags=0, sock=None, local_addr=None, server_hostname=None, ssl_handshake_timeout=None)")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("建立网络连接并返回一对"),s("code",[t._v("(reader, writer)")]),t._v("对象。")])]),t._v(" "),s("li",[s("p",[t._v("返回的 reader 和 writer 对象是"),s("code",[t._v("StreamReader")]),t._v(" 和"),s("code",[t._v("StreamWriter")]),t._v("类的实例。")])]),t._v(" "),s("li",[s("p",[t._v("loop 参数是可选的，当从协程中等待该函数时，总是可以自动确定。")])]),t._v(" "),s("li",[s("p",[t._v("limit 确定返回的 "),s("code",[t._v("StreamReader")]),t._v(" 实例使用的缓冲区大小限制。默认情况下，limit 设置为 64 KiB 。")])]),t._v(" "),s("li",[s("p",[t._v("其余的参数直接传递到"),s("code",[t._v("loop.create_connection()")]),t._v(" 。")])])]),t._v(" "),s("p",[t._v("3.7 新版功能: "),s("code",[t._v("ssl_handshake_timeout")]),t._v(" 形参。")]),t._v(" "),s("h3",{attrs:{id:"asyncio-start-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asyncio-start-server"}},[t._v("#")]),t._v(" "),s("code",[t._v("asyncio.start_server")])]),t._v(" "),s("p",[s("code",[t._v("coroutine asyncio.start_server(client_connected_cb, host=None, port=None, *, loop=None, limit=None, family=socket.AF_UNSPEC, flags=socket.AI_PASSIVE, sock=None, backlog=100, ssl=None, reuse_address=None, reuse_port=None, ssl_handshake_timeout=None, start_serving=True)")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("启动套接字服务。")])]),t._v(" "),s("li",[s("p",[t._v("当一个新的客户端连接被建立时，回调函数 "),s("code",[t._v("client_connected_cb")]),t._v(" 会被调用。该函数会接收到一对参数 "),s("code",[t._v("(reader, writer)")]),t._v("，reader是类 "),s("code",[t._v("StreamReader")]),t._v(" 的实例，而writer是类 "),s("code",[t._v("StreamWriter")]),t._v("的实例。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("client_connected_cb")]),t._v(" 即可以是普通的可调用对象也可以是一个 协程函数; 如果它是一个协程函数，它将自动作为 Task 被调度。")])]),t._v(" "),s("li",[s("p",[t._v("loop 参数是可选的。当在一个协程中await该方法时，该参数始终可以自动确定。")])]),t._v(" "),s("li",[s("p",[t._v("limit 确定返回的"),s("code",[t._v("StreamReader")]),t._v(" 实例使用的缓冲区大小限制。默认情况下，limit 设置为 64 KiB 。")])]),t._v(" "),s("li",[s("p",[t._v("余下的参数将会直接传递给"),s("code",[t._v("loop.create_server()")]),t._v(".")])])]),t._v(" "),s("h2",{attrs:{id:"unix-套接字"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#unix-套接字"}},[t._v("#")]),t._v(" Unix 套接字")]),t._v(" "),s("h3",{attrs:{id:"asyncio-open-unix-connection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asyncio-open-unix-connection"}},[t._v("#")]),t._v(" "),s("code",[t._v("asyncio.open_unix_connection")])]),t._v(" "),s("p",[s("code",[t._v("coroutine asyncio.open_unix_connection(path=None, *, loop=None, limit=None, ssl=None, sock=None, server_hostname=None, ssl_handshake_timeout=None)")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("建立一个 Unix 套接字连接并返回"),s("code",[t._v("(reader, writer)")]),t._v("这对返回值。")])]),t._v(" "),s("li",[s("p",[t._v("与 "),s("code",[t._v("open_connection()")]),t._v("相似，但是是在 Unix 套接字上的操作。")])]),t._v(" "),s("li",[s("p",[t._v("套接字family为"),s("code",[t._v("AF_UNIX")]),t._v("; 套接字类型为"),s("code",[t._v("SOCK_STREAM")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("成功返回一个元组。"),s("code",[t._v("(transport, prostocol)")])])]),t._v(" "),s("li",[s("p",[s("em",[t._v("path")]),t._v("是Unix域套接字的名称，并且是必需的，除非指定了"),s("em",[t._v("sock")]),t._v("参数。摘要Unix套接字， "),s("code",[t._v("str")]),t._v("，"),s("code",[t._v("bytes")]),t._v("，和"),s("code",[t._v("Path")]),t._v("路径的支持。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("可用性: Unix。")])]),t._v(" "),s("p",[t._v("3.7 新版功能: ssl_handshake_timeout 形参。")]),t._v(" "),s("p",[t._v("在 3.7 版更改: path 现在是一个 path-like object")]),t._v(" "),s("h3",{attrs:{id:"asyncio-start-unix-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#asyncio-start-unix-server"}},[t._v("#")]),t._v(" "),s("code",[t._v("asyncio.start_unix_server")])]),t._v(" "),s("p",[s("code",[t._v("coroutine asyncio.start_unix_server(client_connected_cb, path=None, *, loop=None, limit=None, sock=None, backlog=100, ssl=None, ssl_handshake_timeout=None, start_serving=True)")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("启动一个 Unix 套接字服务。")])]),t._v(" "),s("li",[s("p",[t._v("与 "),s("code",[t._v("start_server()")]),t._v("相似，但是是在 Unix 套接字上的操作。")])]),t._v(" "),s("li",[s("p",[t._v("套接字family为"),s("code",[t._v("AF_UNIX")]),t._v("; 套接字类型为"),s("code",[t._v("SOCK_STREAM")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("成功返回一个元组。"),s("code",[t._v("(transport, protocol)")])])]),t._v(" "),s("li",[s("p",[s("em",[t._v("path")]),t._v("是Unix域套接字的名称，并且是必需的，除非指定了"),s("em",[t._v("sock")]),t._v("参数。摘要Unix套接字， "),s("code",[t._v("str")]),t._v("，"),s("code",[t._v("bytes")]),t._v("，和"),s("code",[t._v("Path")]),t._v("路径的支持。")])])]),t._v(" "),s("blockquote",[s("p",[t._v("可用性: Unix。")])]),t._v(" "),s("p",[t._v("3.7 新版功能: The ssl_handshake_timeout and start_serving parameters.")]),t._v(" "),s("p",[t._v("在 3.7 版更改: path 形参现在可以是 path-like object 对象。")]),t._v(" "),s("h2",{attrs:{id:"streamreader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#streamreader"}},[t._v("#")]),t._v(" StreamReader")]),t._v(" "),s("p",[s("code",[t._v("class asyncio.StreamReader")])]),t._v(" "),s("p",[t._v("这个类表示一个读取器对象，该对象提供api以便于从IO流中读取数据。")]),t._v(" "),s("p",[t._v("不推荐直接实例化 "),s("em",[t._v("StreamReader")]),t._v(" 对象，建议使用 open_connection() 和 start_server() 来获取 "),s("em",[t._v("StreamReader")]),t._v(" 实例。")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("coroutine read(n=-1)")])]),t._v(" "),s("p",[t._v("至多读取 "),s("em",[t._v("n")]),t._v(" 个byte。 如果没有设置 "),s("em",[t._v("n")]),t._v(" , 则自动置为 "),s("code",[t._v("-1")]),t._v(" ， -1时表示读至 EOF 并返回所有读取的byte。")]),t._v(" "),s("p",[t._v("如果读到EOF，且内部缓冲区为空，则返回一个空的 "),s("code",[t._v("bytes")]),t._v(" 对象。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("coroutine readline()")])]),t._v(" "),s("p",[t._v("读取一行，其中“行”指的是以 "),s("code",[t._v("\\n")]),t._v(" 结尾的字节序列。")]),t._v(" "),s("p",[t._v("如果读到EOF而没有找到 "),s("code",[t._v("\\n")]),t._v(" ，该方法返回部分读取的数据。")]),t._v(" "),s("p",[t._v("如果读到EOF，且内部缓冲区为空，则返回一个空的 "),s("code",[t._v("bytes")]),t._v(" 对象。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("coroutine readexactly(n)")])]),t._v(" "),s("p",[t._v("精确读取 "),s("em",[t._v("n")]),t._v(" 个 bytes，不会超过也不能少于。")]),t._v(" "),s("p",[t._v("如果在读取完 "),s("em",[t._v("n")]),t._v(" 个byte之前读取到EOF，则会引发 "),s("code",[t._v("IncompleteReadError")]),t._v(" 异常。使用 "),s("code",[t._v("IncompleteReadError.partial")]),t._v(" 属性来获取到达流结束之前读取的 bytes 字符串。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("coroutine readuntil(separator=b'\\n')")])]),t._v(" "),s("p",[t._v("从流中读取数据直至遇到 "),s("code",[t._v("separator")])]),t._v(" "),s("p",[t._v("成功后，数据和指定的"),s("code",[t._v("separator")]),t._v("将从内部缓冲区中删除(或者说被消费掉)。返回的数据将包括在末尾的指定"),s("code",[t._v("separator")]),t._v("。")]),t._v(" "),s("p",[t._v("如果读取的数据量超过了配置的流限制，将引发"),s("code",[t._v("LimitOverrunError")]),t._v("异常，数据将留在内部缓冲区中并可以再次读取。")]),t._v(" "),s("p",[t._v("如果在找到完整的"),s("code",[t._v("separator")]),t._v("之前到达EOF，则会引发"),s("code",[t._v("IncompleteReadError")]),t._v(" 异常，并重置内部缓冲区。 "),s("code",[t._v("IncompleteReadError.partial")]),t._v("属性可能包含指定separator的一部分。")]),t._v(" "),s("p",[t._v("3.5.2 新版功能.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("at_eof()")])]),t._v(" "),s("p",[t._v("如果缓冲区为空并且 "),s("code",[t._v("feed_eof()")]),t._v(" 被调用，则返回 "),s("code",[t._v("True")]),t._v(" 。")])])]),t._v(" "),s("h2",{attrs:{id:"streamwriter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#streamwriter"}},[t._v("#")]),t._v(" StreamWriter")]),t._v(" "),s("p",[s("code",[t._v("class asyncio.StreamWriter")])]),t._v(" "),s("p",[t._v("这个类表示一个写入器对象，该对象提供api以便于写数据至IO流中。")]),t._v(" "),s("p",[t._v("不建议直接实例化 "),s("code",[t._v("StreamWriter")]),t._v("；而应改用 "),s("code",[t._v("open_connection()")]),t._v(" 和 "),s("code",[t._v("start_server()")]),t._v("。")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("write(data)")])]),t._v(" "),s("p",[t._v("此方法会尝试立即将 "),s("em",[t._v("data")]),t._v(" 写入到下层的套接字。 如果写入失败，数据会被排入内部写缓冲队列直到可以被发送。")]),t._v(" "),s("p",[t._v("此方法应当与 "),s("code",[t._v("drain()")]),t._v(" 方法一起使用:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("writelines(data)")])]),t._v(" "),s("p",[t._v("此方法会立即尝试将一个字节串列表（或任何可迭代对象）写入到下层的套接字。 如果写入失败，数据会被排入内部写缓冲队列直到可以被发送。")]),t._v(" "),s("p",[t._v("此方法应当与 "),s("code",[t._v("drain()")]),t._v(" 方法一起使用:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("writelines"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lines"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("close()")])]),t._v(" "),s("p",[t._v("此方法会关闭流以及下层的套接字。")]),t._v(" "),s("p",[t._v("此方法应与 "),s("code",[t._v("wait_closed()")]),t._v(" 方法一起使用:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_closed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("can_write_eof()")])]),t._v(" "),s("p",[t._v("如果下层的传输支持 "),s("code",[t._v("write_eof()")]),t._v("方法则返回"),s("code",[t._v("True")]),t._v("，否则返回 "),s("code",[t._v("False")]),t._v("。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("write_eof()")])]),t._v(" "),s("p",[t._v("在已缓冲的写入数据被刷新后关闭流的写入端。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("transport")])]),t._v(" "),s("p",[t._v("返回下层的"),s("code",[t._v("asyncio")]),t._v(" 传输。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("get_extra_info(name, default=None)")])]),t._v(" "),s("p",[t._v("访问可选的传输信息；详情参见 "),s("a",{attrs:{href:"https://docs.python.org/zh-cn/3/library/asyncio-protocol.html#asyncio.BaseTransport.get_extra_info",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("BaseTransport.get_extra_info()")]),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("coroutine drain()")])]),t._v(" "),s("p",[t._v("等待直到可以适当地恢复写入到流。 示例:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" writer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("drain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这是一个与下层的 IO 写缓冲区进行交互的流程控制方法。 当缓冲区大小达到最高水位（最大上限）时，"),s("code",[t._v("drain()")]),t._v("会阻塞直到缓冲区大小减少至最低水位以便恢复写入。 当没有要等待的数据时，"),s("code",[t._v("drain()")]),t._v("会立即返回。")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("is_closing()")])]),t._v(" "),s("p",[t._v("如果流已被关闭或正在被关闭则返回 "),s("code",[t._v("True")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("3.7 新版功能.")])])]),t._v(" "),s("li",[s("p",[s("code",[t._v("coroutine wait_closed()")])]),t._v(" "),s("p",[t._v("等待直到流被关闭。")]),t._v(" "),s("p",[t._v("应当在 "),s("code",[t._v("close()")]),t._v(" 之后被调用以便等待直到下层的连接被关闭。")]),t._v(" "),s("p",[t._v("3.7 新版功能.")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);